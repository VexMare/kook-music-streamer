# ⚙️ KOOK音乐机器人 - 配置说明

## 📋 配置文件位置

**主配置文件**: `Main/config.py`

---

## 🔧 配置项说明

### 1. FFmpeg路径配置
```python
ffmpeg_path = "D:/GitHub/KOOK_Audio/Main/ffmpeg/bin/ffmpeg.exe"
```
- **作用**: 指定FFmpeg可执行文件的路径
- **要求**: 必须是有效的FFmpeg.exe文件路径
- **修改**: 根据您的实际FFmpeg安装位置修改

### 2. 机器人Token配置
```python
bot_token = "1/Mzg0MjE=/O02aee6F14ixnJfYns4AuA=="
```
- **作用**: KOOK机器人的访问令牌
- **获取**: 从KOOK开发者平台获取
- **安全**: 请勿泄露给他人

### 3. 音乐API配置
```python
# 新API地址 (推荐使用)
music_api_base = "https://mapi.chixiaotao.cn"

# 备用API地址 (如果新API不可用时可以切换)
# music_api_base = "https://music-api.focalors.ltd"  # 已停止服务
# music_api_base = "https://api.music.liuzhijin.cn"  # 备用选项
```
- **作用**: 指定音乐搜索和播放的API服务地址
- **推荐**: 使用 `https://mapi.chixiaotao.cn`
- **备用**: 如果主API不可用，可以切换到备用API

---

## 🛠️ 配置管理方法

### 方法1: 使用配置管理工具（推荐）
```bash
python test_files/api_config_manager.py
```

**功能**:
- 查看当前API配置
- 测试API可用性
- 一键切换到推荐API
- 自定义API地址

### 方法2: 直接编辑配置文件
```bash
# 使用文本编辑器打开
notepad config.py
# 或
code config.py
```

**注意事项**:
- 保持Python语法正确
- 字符串用双引号包围
- 路径使用正斜杠 `/` 或双反斜杠 `\\`

---

## 🔄 API切换指南

### 当前推荐API
- **地址**: `https://mapi.chixiaotao.cn`
- **状态**: ✅ 完全可用
- **功能**: 搜索、URL获取、歌单

### 备用API选项
1. **刘志进API**: `https://api.music.liuzhijin.cn`
2. **Vercel部署**: `https://netease-cloud-music-api-tau-six.vercel.app`
3. **自建API**: 本地部署的NeteaseCloudMusicApi

### 切换步骤
1. 运行配置管理工具
2. 选择"测试当前API"
3. 如果测试失败，选择"切换到备用API"
4. 重新启动机器人

---

## 🔍 配置验证

### 验证FFmpeg配置
```bash
# 检查FFmpeg是否可用
python -c "import subprocess; subprocess.run(['D:/GitHub/KOOK_Audio/Main/ffmpeg/bin/ffmpeg.exe', '-version'])"
```

### 验证API配置
```bash
# 测试API可用性
python test_files/test_new_api.py
```

### 验证机器人配置
```bash
# 启动机器人测试
python test_files/run_bot.py
```

---

## ⚠️ 常见配置问题

### 问题1: FFmpeg路径错误
**错误**: `FileNotFoundError: [WinError 2] The system cannot find the file specified`

**解决**:
1. 检查FFmpeg是否已安装
2. 确认路径是否正确
3. 使用绝对路径

### 问题2: API连接失败
**错误**: `requests.exceptions.ConnectionError`

**解决**:
1. 检查网络连接
2. 测试API可用性
3. 切换到备用API

### 问题3: Token无效
**错误**: `khl.exceptions.TokenError`

**解决**:
1. 检查Token是否正确
2. 确认机器人权限
3. 重新生成Token

---

## 📝 配置备份

### 备份当前配置
```bash
# 复制配置文件
copy config.py config_backup.py
```

### 恢复配置
```bash
# 恢复备份的配置
copy config_backup.py config.py
```

---

## 🎯 最佳实践

### 1. 定期备份配置
- 修改配置前先备份
- 保存多个版本的配置
- 记录配置变更历史

### 2. 测试配置变更
- 修改配置后立即测试
- 验证所有功能正常
- 准备回滚方案

### 3. 监控API状态
- 定期测试API可用性
- 关注API服务状态
- 及时切换到备用API

---

## 📞 技术支持

### 配置问题排查
1. **检查语法**: 确保Python语法正确
2. **验证路径**: 确认文件路径存在
3. **测试连接**: 验证网络和API连接
4. **查看日志**: 检查错误日志信息

### 获取帮助
- 使用配置管理工具进行诊断
- 查看使用说明文档
- 运行测试工具验证功能

---

**🎯 配置管理工具**: `python test_files/api_config_manager.py`

**📁 配置文件**: `Main/config.py`

**🔧 测试工具**: `python test_files/test_new_api.py`

